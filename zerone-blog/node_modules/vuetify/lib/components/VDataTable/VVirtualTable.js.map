{"version":3,"sources":["../../../src/components/VDataTable/VVirtualTable.ts"],"names":[],"mappings":"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","sourcesContent":["import './VVirtualTable.sass'\n\n// Components\nimport VSimpleTable from './VSimpleTable'\n\n// Types\nimport { VNode, VNodeChildren } from 'vue'\nimport { PropValidator } from 'vue/types/options'\nimport mixins from '../../util/mixins'\n\n// Utiltiies\nimport { convertToUnit, debounce } from '../../util/helpers'\n\n// Types\nconst baseMixins = mixins(VSimpleTable)\n\ninterface options extends InstanceType<typeof baseMixins> {\n  $refs: {\n    table: HTMLElement\n  }\n  cachedItems: VNodeChildren\n}\n\nexport default baseMixins.extend<options>().extend({\n  name: 'v-virtual-table',\n\n  props: {\n    chunkSize: {\n      type: Number,\n      default: 25,\n    },\n    headerHeight: {\n      type: Number,\n      default: 48,\n    },\n    items: {\n      type: Array,\n      default: () => ([]),\n    } as PropValidator<any[]>,\n    rowHeight: {\n      type: Number,\n      default: 48,\n    },\n  },\n\n  data: () => ({\n    scrollTop: 0,\n    oldChunk: 0,\n    scrollDebounce: null as any,\n    invalidateCache: false,\n  }),\n\n  computed: {\n    itemsLength (): number {\n      return this.items.length\n    },\n    totalHeight (): number {\n      return (this.itemsLength * this.rowHeight) + this.headerHeight\n    },\n    topIndex (): number {\n      return Math.floor(this.scrollTop / this.rowHeight)\n    },\n    chunkIndex (): number {\n      return Math.floor(this.topIndex / this.chunkSize)\n    },\n    startIndex (): number {\n      return Math.max(0, (this.chunkIndex * this.chunkSize) - this.chunkSize)\n    },\n    offsetTop (): number {\n      return Math.max(0, this.startIndex * this.rowHeight)\n    },\n    stopIndex (): number {\n      return Math.min(this.startIndex + (this.chunkSize * 3), this.itemsLength)\n    },\n    offsetBottom (): number {\n      return Math.max(0, (this.itemsLength - this.stopIndex - this.startIndex) * this.rowHeight)\n    },\n  },\n\n  watch: {\n    chunkIndex (newValue, oldValue) {\n      this.oldChunk = oldValue\n    },\n    items () {\n      this.cachedItems = null\n      this.$refs.table.scrollTop = 0\n    },\n  },\n\n  created () {\n    this.cachedItems = null\n  },\n\n  mounted () {\n    this.scrollDebounce = debounce(this.onScroll, 50)\n\n    this.$refs.table.addEventListener('scroll', this.scrollDebounce, { passive: true })\n  },\n\n  beforeDestroy () {\n    this.$refs.table.removeEventListener('scroll', this.scrollDebounce)\n  },\n\n  methods: {\n    createStyleHeight (height: number) {\n      return {\n        height: `${height}px`,\n      }\n    },\n    genBody () {\n      if (this.cachedItems === null || this.chunkIndex !== this.oldChunk) {\n        this.cachedItems = this.genItems()\n        this.oldChunk = this.chunkIndex\n      }\n\n      return this.$createElement('tbody', [\n        this.$createElement('tr', { style: this.createStyleHeight(this.offsetTop) }),\n        this.cachedItems,\n        this.$createElement('tr', { style: this.createStyleHeight(this.offsetBottom) }),\n      ])\n    },\n    genItems () {\n      return this.$scopedSlots.items!({ items: this.items.slice(this.startIndex, this.stopIndex) })\n    },\n    onScroll (e: Event) {\n      const target = e.target as Element\n      this.scrollTop = target.scrollTop\n    },\n    genTable () {\n      return this.$createElement('div', {\n        ref: 'table',\n        staticClass: 'v-virtual-table__table',\n      }, [\n        this.$createElement('table', [\n          this.$slots['body.before'],\n          this.genBody(),\n          this.$slots['body.after'],\n        ]),\n      ])\n    },\n    genWrapper () {\n      return this.$createElement('div', {\n        staticClass: 'v-virtual-table__wrapper',\n        style: {\n          height: convertToUnit(this.height),\n        },\n      }, [\n        this.genTable(),\n      ])\n    },\n  },\n\n  render (h): VNode {\n    return h('div', {\n      staticClass: 'v-data-table v-virtual-table',\n      class: this.classes,\n    }, [\n      this.$slots.top,\n      this.genWrapper(),\n      this.$slots.bottom,\n    ])\n  },\n})\n"],"sourceRoot":""}