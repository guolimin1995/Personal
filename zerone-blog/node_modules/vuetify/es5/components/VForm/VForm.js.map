{"version":3,"sources":["../../../src/components/VForm/VForm.ts"],"names":[],"mappings":"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","sourcesContent":["// Styles\nimport './VForm.sass'\n\n// Components\nimport VInput from '../VInput/VInput'\n\n// Mixins\nimport { provide as RegistrableProvide } from '../../mixins/registrable'\n\n// Helpers\nimport { VNode } from 'vue'\n\ntype ErrorBag = Record<number, boolean>\ntype VInputInstance = InstanceType<typeof VInput>\ntype Watchers = {\n  _uid: number\n  valid: () => void\n  shouldValidate: () => void\n}\n\n/* @vue/component */\nexport default RegistrableProvide('form').extend({\n  name: 'v-form',\n\n  inheritAttrs: false,\n\n  props: {\n    value: Boolean,\n    lazyValidation: Boolean,\n  },\n\n  data: () => ({\n    inputs: [] as VInputInstance[],\n    watchers: [] as Watchers[],\n    errorBag: {} as ErrorBag,\n  }),\n\n  watch: {\n    errorBag: {\n      handler (val) {\n        const errors = Object.values(val).includes(true)\n\n        this.$emit('input', !errors)\n      },\n      deep: true,\n      immediate: true,\n    },\n  },\n\n  methods: {\n    watchInput (input: any): Watchers {\n      const watcher = (input: any): (() => void) => {\n        return input.$watch('hasError', (val: boolean) => {\n          this.$set(this.errorBag, input._uid, val)\n        }, { immediate: true })\n      }\n\n      const watchers: Watchers = {\n        _uid: input._uid,\n        valid: () => {},\n        shouldValidate: () => {},\n      }\n\n      if (this.lazyValidation) {\n        // Only start watching inputs if we need to\n        watchers.shouldValidate = input.$watch('shouldValidate', (val: boolean) => {\n          if (!val) return\n\n          // Only watch if we're not already doing it\n          if (this.errorBag.hasOwnProperty(input._uid)) return\n\n          watchers.valid = watcher(input)\n        })\n      } else {\n        watchers.valid = watcher(input)\n      }\n\n      return watchers\n    },\n    /** @public */\n    validate (): boolean {\n      return this.inputs.every(input => input.validate(true))\n    },\n    /** @public */\n    reset (): void {\n      this.inputs.forEach(input => input.reset())\n      this.resetErrorBag()\n    },\n    resetErrorBag () {\n      if (this.lazyValidation) {\n        // Account for timeout in validatable\n        setTimeout(() => {\n          this.errorBag = {}\n        }, 0)\n      }\n    },\n    /** @public */\n    resetValidation () {\n      this.inputs.forEach(input => input.resetValidation())\n      this.resetErrorBag()\n    },\n    register (input: VInputInstance) {\n      this.inputs.push(input)\n      this.watchers.push(this.watchInput(input))\n    },\n    unregister (input: VInputInstance) {\n      const found = this.inputs.find(i => i._uid === input._uid)\n\n      if (!found) return\n\n      const unwatch = this.watchers.find(i => i._uid === found._uid)\n      if (unwatch) {\n        unwatch.valid()\n        unwatch.shouldValidate()\n      }\n\n      this.watchers = this.watchers.filter(i => i._uid !== found._uid)\n      this.inputs = this.inputs.filter(i => i._uid !== found._uid)\n      this.$delete(this.errorBag, found._uid)\n    },\n  },\n\n  render (h): VNode {\n    return h('form', {\n      staticClass: 'v-form',\n      attrs: {\n        novalidate: true,\n        ...this.$attrs,\n      },\n      on: {\n        submit: (e: Event) => this.$emit('submit', e),\n      },\n    }, this.$slots.default)\n  },\n})\n"],"sourceRoot":""}